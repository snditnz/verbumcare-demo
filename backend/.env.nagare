# Verbumcare Nagare (流れ) - Japan Edge Server Configuration
# Offline-first healthcare documentation with local AI
# Server: nagare.local (Ubuntu 24.04 LTS)

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
DATABASE_URL=postgres://nagare:nagare_secure_password_change_me@postgres:5432/nagare_db

# IMPORTANT: Change the default password before production deployment!

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================
PORT=3000
NODE_ENV=production

# CORS - SSL subdomains only (no http, no external domains)
CLIENT_URLS=https://admin.nagare.local,https://api.nagare.local

# ============================================================================
# AI SERVICES - Local Bare Metal (No Cloud, No OpenAI)
# ============================================================================

# Whisper (faster-whisper systemd service on Ubuntu host)
# Use Docker gateway IP (find with: docker network inspect verbumcare_nagare-network | grep Gateway)
WHISPER_URL=http://172.18.0.1:8080
WHISPER_MODEL=medium
WHISPER_LANGUAGE=ja

# Ollama (systemd service on Ubuntu host)
OLLAMA_URL=http://172.18.0.1:11434
OLLAMA_MODEL=llama3.1:8b
OLLAMA_NUM_CTX=2048
OLLAMA_NUM_THREAD=8
OLLAMA_TEMPERATURE=0.1

# NO OpenAI - Completely offline operation
# OPENAI_API_KEY=  # Not used - local AI only

# ============================================================================
# NAGARE EDGE SERVER SETTINGS
# ============================================================================

# Edge server identification
EDGE_SERVER_NAME=Nagare Demo Edge Server
EDGE_SERVER_ID=nagare-demo-001
EDGE_LOCATION=Tokyo, Japan

# Cloud sync (future feature - currently disabled)
CLOUD_SYNC_ENABLED=false
CLOUD_SYNC_URL=https://nagare.verbumcare.com
CLOUD_SYNC_INTERVAL=300000  # 5 minutes (when enabled)

# Offline operation
OFFLINE_MODE=true
OFFLINE_DATA_RETENTION_DAYS=90

# ============================================================================
# SSL/SECURITY SETTINGS
# ============================================================================

# SSL termination handled by nginx
TRUST_PROXY=true
SECURE_COOKIES=true

# Session security
SESSION_SECRET=change_me_to_random_string_in_production
SESSION_TIMEOUT=3600000  # 1 hour

# ============================================================================
# JAPANESE LOCALIZATION
# ============================================================================

DEFAULT_LANGUAGE=ja
SUPPORTED_LANGUAGES=ja,en,zh-TW
TIMEZONE=Asia/Tokyo

# Medical terminology
MEDICAL_TERMINOLOGY_STANDARD=HOT  # Japanese HOT code system
DATE_FORMAT=YYYY年MM月DD日
TIME_FORMAT=HH:mm

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================

# File uploads (voice recordings)
MAX_UPLOAD_SIZE=50mb
UPLOAD_TIMEOUT=120000  # 2 minutes

# AI processing timeouts
WHISPER_TIMEOUT=120000  # 2 minutes
OLLAMA_TIMEOUT=120000   # 2 minutes

# Database connection pooling
DB_POOL_MIN=2
DB_POOL_MAX=10

# ============================================================================
# LOGGING
# ============================================================================

LOG_LEVEL=info
LOG_FILE=/app/logs/nagare.log
LOG_MAX_SIZE=10mb
LOG_MAX_FILES=7

# Audit logging (for healthcare compliance)
AUDIT_LOG_ENABLED=true
AUDIT_LOG_FILE=/app/logs/audit.log

# ============================================================================
# DEPLOYMENT NOTES
# ============================================================================
#
# Nagare Edge Server Architecture:
#
# Ubuntu Host (bare metal):
#   ├── Ollama (port 11434)
#   ├── faster-whisper (port 8080)
#   └── Avahi mDNS (for .nagare.local)
#
# Docker Services:
#   ├── PostgreSQL (port 5432)
#   ├── Backend API (port 3000)
#   └── nginx (ports 80, 443)
#       ├── https://api.nagare.local → Backend
#       └── https://admin.nagare.local → Admin Portal
#
# SSL:
#   └── Local CA with proper certificates
#       └── Install ca.crt on all client devices
#
# Access from client devices:
#   - API: https://api.nagare.local
#   - Admin: https://admin.nagare.local
#   - All traffic encrypted with local CA
#
# Startup sequence:
#   1. sudo ./mdns/setup-mdns.sh        # Configure mDNS
#   2. ./ssl/setup-local-ca.sh          # Generate SSL certificates
#   3. ./nagare-start.sh                # Start all services
#   4. Install ssl/certs/ca.crt on iPad # Trust certificate
#
# Future cloud sync:
#   - Set CLOUD_SYNC_ENABLED=true
#   - Configure CLOUD_SYNC_URL
#   - Edge server will sync to nagare.verbumcare.com
#
# ============================================================================
